<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åš´æ ¼æ•¸ç¨ (Sudoku Strict)</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --board-bg: #fff;
            --line-color: #344861;
            --highlight-color: #e2ebf3;
            --selected-color: #bbdefb;
            --same-num-color: #cbf0f8;
            --error-color: #f7cfd6;
            --text-color: #344861;
            --filled-color: #0072e3;
            --fixed-color: #000;
            --thin-border: #c6d2df; 
            --note-color: #7f8c8d;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            user-select: none; /* ç¦æ­¢é¸å–æ–‡å­— */
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        /* --- é ‚éƒ¨è³‡è¨Šåˆ— --- */
        .top-bar {
            width: 90vw;
            max-width: 450px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            color: var(--text-color);
        }
        
        .info-group { display: flex; gap: 15px; align-items: center; }
        .mistake-counter { font-weight: bold; color: #555; }
        .mistake-counter.warning { color: #e74c3c; }
        .timer { font-size: 20px; font-weight: bold; font-variant-numeric: tabular-nums; }
        .seed-display { font-size: 12px; color: #888; cursor: pointer; text-decoration: underline; }

        /* --- é›£åº¦é¸æ“‡åˆ— --- */
        .difficulty-bar {
            width: 90vw;
            max-width: 450px;
            margin-bottom: 10px;
            display: flex;
            gap: 5px;
            background: #e2e6ea;
            padding: 4px;
            border-radius: 25px;
        }

        .diff-btn {
            flex: 1;
            padding: 6px 0;
            text-align: center;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            transition: all 0.2s;
        }
        .diff-btn.active { background-color: var(--filled-color); color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

        /* --- æ•¸ç¨æ£‹ç›¤ (æ ¼ç·šä¿®å¾©æ ¸å¿ƒ) --- */
        #sudoku-board {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            width: 90vw;
            max-width: 450px;
            aspect-ratio: 1 / 1; 
            background-color: var(--board-bg);
            /* æ”¹ç”¨ padding ä»£æ›¿ gapï¼Œä¸¦ç”¨ border åŒ…è¦† */
            gap: 0; 
            border: 3px solid var(--line-color); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 10px;
            position: relative;
            box-sizing: border-box;
            padding: 0; /* ç¢ºä¿å…§å®¹è²¼é½Šé‚Šæ¡† */
        }

        /* å–®å…ƒæ ¼æ¨£å¼ */
        .cell {
            background-color: var(--board-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: 500;
            color: var(--fixed-color);
            cursor: pointer;
            position: relative;
            box-sizing: border-box;

            /* æ ¸å¿ƒä¿®å¾©ï¼šå¼·åˆ¶æ‰€æœ‰æ ¼å­éƒ½æœ‰ 1px é‚Šæ¡† */
            border: 1px solid var(--thin-border);
            /* ä½¿ç”¨è² é‚Šè·è®“é‚Šæ¡†é‡ç–Šï¼Œé¿å…è®Šç²—æˆ–æ¶ˆå¤± */
            margin-right: -1px;
            margin-bottom: -1px;
            z-index: 1; /* åŸºç¤å±¤ç´š */
        }

        /* 3x3 ç²—ç·šï¼šæé«˜å±¤ç´šè¦†è“‹ç´°ç·š */
        .cell.border-right {
            border-right: 2px solid var(--line-color) !important;
            z-index: 5; /* æµ®åœ¨ç´°ç·šä¸Šé¢ */
        }
        .cell.border-bottom {
            border-bottom: 2px solid var(--line-color) !important;
            z-index: 5; /* æµ®åœ¨ç´°ç·šä¸Šé¢ */
        }

        /* é‚Šç·£è™•ç†ï¼šé˜²æ­¢æœ€å¾Œä¸€æ’æº¢å‡ºå®¹å™¨ */
        .cell:nth-child(9n) { margin-right: 0; border-right: none; }
        .cell:nth-child(n+73) { margin-bottom: 0; border-bottom: none; }


        /* --- ç­†è¨˜ (Notes) æ¨£å¼ --- */
        .note-grid {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            pointer-events: none; /* è®“é»æ“Šç©¿é€ */
        }
        .note-num {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 9px; /* å­—é«”èª¿å°ä¸€é»ä»¥å…å¤ªæ“  */
            color: var(--note-color);
            font-weight: normal;
        }

        /* --- ç‹€æ…‹æ¨£å¼ --- */
        .cell.selected { background-color: var(--selected-color) !important; z-index: 2; } /* é¸å–æ™‚ç¨å¾®æµ®èµ· */
        .cell.same-number { background-color: var(--same-num-color) !important; }
        .cell.highlight { background-color: var(--highlight-color); }
        .cell.error { background-color: var(--error-color) !important; color: #e74c3c !important; }
        .cell.fixed { font-weight: bold; }
        .cell.user-input { color: var(--filled-color); }

        /* æ–æ™ƒå‹•ç•« */
        @keyframes shake {
            0% { transform: translate(1px, 1px); } 20% { transform: translate(-3px, 0px); }
            40% { transform: translate(3px, 0px); } 60% { transform: translate(-3px, 0px); }
            100% { transform: translate(0, 0); }
        }
        .shake-animation { animation: shake 0.4s; }

        /* --- åŠŸèƒ½æŒ‰éˆ• --- */
        .game-actions {
            width: 90vw;
            max-width: 450px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-bottom: 5px;
        }

        .action-btn {
            padding: 10px 0;
            border: 1px solid var(--filled-color);
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            font-weight: bold;
            color: var(--filled-color);
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .action-btn:hover { background-color: #f0f7ff; }
        .btn-new { background-color: var(--filled-color); color: white; }

        /* --- æ•¸å­—éµç›¤ --- */
        .numpad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            width: 90vw;
            max-width: 450px;
            user-select: none; 
            touch-action: none; /* é—œéµï¼šé˜²æ­¢ä¸‹æ»‘æ™‚è§¸ç™¼ç€è¦½å™¨æ»¾å‹• */
        }

        .num-btn {
            background-color: white;
            border: 1px solid #c6d2df;
            border-radius: 8px;
            height: 54px; /* åŠ é«˜æ–¹ä¾¿ä¸‹æ»‘ */
            font-size: 24px;
            color: var(--filled-color);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 0 #dce3eb;
            transition: transform 0.1s, background 0.1s;
            position: relative;
        }
        
        /* ä¸‹æ»‘è¦–è¦ºå›é¥‹ */
        .num-btn.swiping {
            background-color: var(--filled-color);
            color: white;
            transform: translateY(6px); /* æ˜é¡¯ä½ç§» */
            box-shadow: none;
        }
        
        .hint-text {
            width: 90vw;
            max-width: 450px;
            text-align: center;
            font-size: 13px;
            color: #888;
            margin-top: 10px;
            padding-bottom: 20px;
        }

        /* Game Over Overlay */
        #game-over-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none; flex-direction: column;
            justify-content: center; align-items: center; z-index: 20;
        }
        #game-over-overlay h2 { margin: 0 0 10px 0; color: #e74c3c; }
        #game-over-overlay button {
            padding: 10px 20px; background: var(--filled-color);
            color: white; border: none; border-radius: 5px; font-size: 16px;
        }

    </style>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0072e3">
<meta name="apple-mobile-web-app-capable" content="yes">
</head>
<body>

    <div class="difficulty-bar">
        <div class="diff-btn" id="btn-easy" onclick="setDifficulty('easy')">ç°¡å–®</div>
        <div class="diff-btn active" id="btn-medium" onclick="setDifficulty('medium')">æ™®é€š</div>
        <div class="diff-btn" id="btn-hard" onclick="setDifficulty('hard')">å›°é›£</div>
        <div class="diff-btn" id="btn-expert" onclick="setDifficulty('expert')">å°ˆå®¶</div>
    </div>

    <div class="top-bar">
        <div class="info-group">
            <span class="seed-display" onclick="copySeed()" id="seed-label">Seed: #----</span>
        </div>
        <div class="info-group">
            <div class="mistake-counter" id="mistake-display">éŒ¯èª¤: 0/3</div>
            <div class="timer" id="timer">00:00</div>
        </div>
    </div>
    
    <div id="sudoku-board">
        <div id="game-over-overlay">
            <h2>éŠæˆ²çµæŸ</h2>
            <p>éŒ¯èª¤æ¬¡æ•¸éå¤šï¼</p>
            <button onclick="initGame()">å†è©¦ä¸€æ¬¡</button>
        </div>
    </div>

    <div class="game-actions">
        <button class="action-btn" onclick="resetCurrentGame()">â†º é‡ä¾†</button>
        <button class="action-btn" onclick="promptSeed()">âœ ç¨®å­</button>
        <button class="action-btn btn-new" onclick="initGame()">+ æ–°å±€</button>
    </div>

    <div class="numpad" id="numpad">
        <div class="num-btn" data-num="1">1</div>
        <div class="num-btn" data-num="2">2</div>
        <div class="num-btn" data-num="3">3</div>
        <div class="num-btn" data-num="4">4</div>
        <div class="num-btn" data-num="5">5</div>
        <div class="num-btn" data-num="6">6</div>
        <div class="num-btn" data-num="7">7</div>
        <div class="num-btn" data-num="8">8</div>
        <div class="num-btn" data-num="9">9</div>
        <div class="num-btn" data-num="X" style="color: #e74c3c;">âœ•</div>
    </div>
    <div class="hint-text">ğŸ’¡ æ“ä½œæŠ€å·§ï¼šé»æ“Šå¯«ç­†è¨˜ï¼Œå‘ä¸‹æ»‘å‹•å¡«å…¥æ•¸å­—</div>

    <script>
        // --- éŠæˆ²ç‹€æ…‹ ---
        let board = [];
        let solution = [];
        let fixedMask = [];
        let notes = []; // ç­†è¨˜è³‡æ–™ï¼šæ¯å€‹æ ¼å­æ˜¯ä¸€å€‹ Set
        let selectedCellIndex = null;
        let timerInterval;
        let seconds = 0;
        let currentSeed = 0; 
        let rngState = 0;
        
        let mistakes = 0;
        const MAX_MISTAKES = 3;
        let isGameOver = false;

        let currentDifficulty = 'medium';
        const DIFFICULTY_HOLES = { 'easy': 30, 'medium': 40, 'hard': 50, 'expert': 58 };

        // --- RNG (éš¨æ©Ÿæ•¸ç”Ÿæˆ) ---
        function seedRandom(seed) { rngState = seed; }
        function myRandom() {
            rngState = (rngState * 9301 + 49297) % 233280;
            return rngState / 233280.0;
        }

        // --- åˆå§‹åŒ–éŠæˆ² ---
        function initGame(seedInput = null) {
            mistakes = 0;
            isGameOver = false;
            updateMistakeUI();
            document.getElementById('game-over-overlay').style.display = 'none';
            document.getElementById('numpad').style.opacity = '1';
            document.getElementById('numpad').style.pointerEvents = 'auto';

            if (seedInput !== null) {
                currentSeed = parseInt(seedInput);
            } else {
                currentSeed = Math.floor(Math.random() * 99999) + 1;
            }
            seedRandom(currentSeed);
            document.getElementById('seed-label').innerText = `Seed: #${currentSeed}`;

            // åˆå§‹åŒ– 81 å€‹æ ¼å­çš„ç­†è¨˜
            notes = Array.from({length: 81}, () => new Set());

            startTimer();
            generateBoard();
            renderBoard();
            selectedCellIndex = null;
        }

        function setDifficulty(level) {
            currentDifficulty = level;
            document.querySelectorAll('.diff-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${level}`).classList.add('active');
            initGame();
        }

        function resetCurrentGame() {
            if (!confirm('ç¢ºå®šè¦æ¸…ç©ºç•¶å‰é€²åº¦ä¸¦é‡ä¾†å—ï¼Ÿ')) return;
            mistakes = 0;
            updateMistakeUI();
            for (let i = 0; i < 81; i++) {
                if (!fixedMask[i]) {
                    board[i] = 0;
                    notes[i].clear();
                }
            }
            startTimer();
            renderBoard();
            if (selectedCellIndex !== null) selectCell(selectedCellIndex);
        }

        // --- ç”Ÿæˆé‚è¼¯ ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(myRandom() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        function generateBoard() {
            solution = Array.from({ length: 81 }, () => 0);
            fillBoardRecursively(solution);
            board = [...solution];
            fixedMask = Array.from({ length: 81 }, () => true);
            let indices = Array.from({length: 81}, (_, i) => i);
            shuffleArray(indices);
            
            let holes = DIFFICULTY_HOLES[currentDifficulty];
            for (let i = 0; i < 81 && holes > 0; i++) {
                let idx = indices[i];
                if (board[idx] !== 0) {
                    board[idx] = 0;
                    fixedMask[idx] = false;
                    holes--;
                }
            }
        }
        function fillBoardRecursively(grid) {
            let emptyIndex = grid.indexOf(0);
            if (emptyIndex === -1) return true;
            let row = Math.floor(emptyIndex / 9);
            let col = emptyIndex % 9;
            let nums = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            shuffleArray(nums);
            for (let num of nums) {
                if (isValid(grid, row, col, num)) {
                    grid[emptyIndex] = num;
                    if (fillBoardRecursively(grid)) return true;
                    grid[emptyIndex] = 0;
                }
            }
            return false;
        }
        function isValid(grid, row, col, num) {
            for (let i = 0; i < 9; i++) {
                if (grid[row * 9 + i] === num) return false;
                if (grid[i * 9 + col] === num) return false;
                let boxRow = 3 * Math.floor(row / 3) + Math.floor(i / 3);
                let boxCol = 3 * Math.floor(col / 3) + (i % 3);
                if (grid[boxRow * 9 + boxCol] === num) return false;
            }
            return true;
        }

        // --- æ¸²æŸ“ (Render) ---
        function renderBoard() {
            const container = document.getElementById('sudoku-board');
            const overlay = document.getElementById('game-over-overlay');
            container.innerHTML = '';
            container.appendChild(overlay);

            board.forEach((num, index) => {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                
                // æ¨™è¨˜ 3x3 å€åŸŸ
                const col = index % 9;
                const row = Math.floor(index / 9);
                if (col === 2 || col === 5) cell.classList.add('border-right');
                if (row === 2 || row === 5) cell.classList.add('border-bottom');

                // å…§å®¹é¡¯ç¤º
                if (num !== 0) {
                    // é¡¯ç¤ºæ•¸å­—
                    cell.textContent = num;
                    if (fixedMask[index]) {
                        cell.classList.add('fixed');
                    } else {
                        cell.classList.add('user-input');
                        if (num !== solution[index]) cell.classList.add('error');
                    }
                } else {
                    // é¡¯ç¤ºç­†è¨˜ (Note Grid)
                    if (notes[index] && notes[index].size > 0) {
                        const noteGrid = document.createElement('div');
                        noteGrid.classList.add('note-grid');
                        for (let n = 1; n <= 9; n++) {
                            const noteNum = document.createElement('div');
                            noteNum.classList.add('note-num');
                            if (notes[index].has(n)) noteNum.textContent = n;
                            noteGrid.appendChild(noteNum);
                        }
                        cell.appendChild(noteGrid);
                    }
                }
                
                cell.onclick = () => selectCell(index);
                container.appendChild(cell);
            });
        }

        function selectCell(index) {
            if (isGameOver) return;
            selectedCellIndex = index;
            const cellDivs = Array.from(document.querySelectorAll('.cell'));
            const selectedVal = board[index];
            
            // æ¸…é™¤èˆŠæ¨£å¼
            cellDivs.forEach(c => c.classList.remove('selected', 'highlight', 'same-number'));
            
            // æ¨™è¨˜ç•¶å‰
            cellDivs[index].classList.add('selected');
            
            // æ¨™è¨˜é—œè¯èˆ‡ç›¸åŒæ•¸å­—
            const row = Math.floor(index / 9);
            const col = index % 9;
            cellDivs.forEach((c, i) => {
                const r = Math.floor(i / 9);
                const c_idx = i % 9;
                if (r === row || c_idx === col) c.classList.add('highlight');
                if (selectedVal !== 0 && board[i] === selectedVal) c.classList.add('same-number');
            });
        }

        // --- æ ¸å¿ƒäº’å‹•ï¼šè§¸æ§ä¸‹æ»‘èˆ‡é»æ“Š ---
        document.querySelectorAll('.num-btn').forEach(btn => {
            let startY = 0;
            let isSwiping = false;
            let num = btn.dataset.num;
            if (num !== 'X') num = parseInt(num);

            const handleStart = (y) => {
                startY = y;
                isSwiping = false;
            };

            const handleMove = (y, el) => {
                const deltaY = y - startY;
                // ä¸‹æ»‘è¶…é 25px è¦–ç‚ºå¡«å¯«æ„åœ–
                if (deltaY > 25) { 
                    isSwiping = true;
                    el.classList.add('swiping');
                } else {
                    el.classList.remove('swiping');
                }
            };

            const handleEnd = (el) => {
                el.classList.remove('swiping');
                if (isSwiping) {
                    fillRealNumber(num); // ä¸‹æ»‘ = å¡«å¯«
                } else {
                    toggleNote(num); // é»æ“Š = ç­†è¨˜
                }
            };

            // Touch Events (æ‰‹æ©Ÿ)
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault(); // ç¦æ­¢ç€è¦½å™¨åŸç”Ÿæ»¾å‹•
                handleStart(e.touches[0].clientY);
            }, {passive: false});

            btn.addEventListener('touchmove', (e) => {
                e.preventDefault(); // ç¦æ­¢ç€è¦½å™¨åŸç”Ÿæ»¾å‹•
                handleMove(e.touches[0].clientY, btn);
            }, {passive: false});

            btn.addEventListener('touchend', (e) => {
                handleEnd(btn);
            });

            // Mouse Events (é›»è…¦/æ¸¬è©¦)
            btn.addEventListener('mousedown', (e) => {
                handleStart(e.clientY);
                const onMouseMove = (moveE) => handleMove(moveE.clientY, btn);
                const onMouseUp = () => {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                    handleEnd(btn);
                };
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            });
        });

        // 1. ç­†è¨˜é‚è¼¯
        function toggleNote(num) {
            if (isGameOver || selectedCellIndex === null) return;
            // å·²æœ‰å¯¦æ•¸æˆ–å›ºå®šé¡Œï¼Œä¸èƒ½å¯«ç­†è¨˜
            if (board[selectedCellIndex] !== 0 || fixedMask[selectedCellIndex]) return;

            if (num === 'X') {
                notes[selectedCellIndex].clear(); // æ¸…ç©ºç­†è¨˜
            } else {
                const cellNotes = notes[selectedCellIndex];
                if (cellNotes.has(num)) cellNotes.delete(num);
                else cellNotes.add(num);
            }
            renderBoard();
            selectCell(selectedCellIndex); // ä¿æŒé«˜äº®
        }

        // 2. å¡«å¯«é‚è¼¯ (å«è‡ªå‹•æ¸…ç†ç­†è¨˜)
        function fillRealNumber(num) {
            if (isGameOver || selectedCellIndex === null || fixedMask[selectedCellIndex]) return;
            
            const cellDivs = document.querySelectorAll('.cell');
            const currentCell = cellDivs[selectedCellIndex];

            // æ¸…é™¤ (X)
            if (num === 'X') {
                board[selectedCellIndex] = 0;
                renderBoard();
                selectCell(selectedCellIndex);
                return;
            }

            // éŒ¯èª¤æª¢æŸ¥
            if (num !== solution[selectedCellIndex]) {
                mistakes++;
                updateMistakeUI();
                currentCell.textContent = num;
                currentCell.classList.add('error', 'shake-animation');
                
                // å»¶é²é‡ç¹ª (æŠŠéŒ¯èª¤æ•¸å­—æ´—æ‰)
                setTimeout(() => renderBoard(), 400);
                
                if (mistakes >= MAX_MISTAKES) triggerGameOver();
            } else {
                // æ­£ç¢ºå¡«å…¥
                board[selectedCellIndex] = num;
                notes[selectedCellIndex].clear(); // æ¸…é™¤è©²æ ¼ç­†è¨˜
                
                // è‡ªå‹•æ¸…ç†è¡çªç­†è¨˜
                cleanConflictingNotes(selectedCellIndex, num);

                renderBoard();
                selectCell(selectedCellIndex);
                checkWin();
            }
        }

        function cleanConflictingNotes(index, num) {
            const row = Math.floor(index / 9);
            const col = index % 9;
            const startRow = Math.floor(row / 3) * 3;
            const startCol = Math.floor(col / 3) * 3;

            for (let i = 0; i < 81; i++) {
                let r = Math.floor(i / 9);
                let c = i % 9;
                
                // æª¢æŸ¥æ˜¯å¦é—œè¯ (åŒè¡Œã€åŒåˆ—ã€åŒå®®)
                let isRelated = (r === row) || (c === col) || 
                                (r >= startRow && r < startRow + 3 && c >= startCol && c < startCol + 3);
                
                if (isRelated && notes[i].has(num)) {
                    notes[i].delete(num);
                }
            }
        }

        // --- è¼”åŠ©åŠŸèƒ½ ---
        function updateMistakeUI() {
            const el = document.getElementById('mistake-display');
            el.innerText = `éŒ¯èª¤: ${mistakes}/${MAX_MISTAKES}`;
            if (mistakes >= 2) el.classList.add('warning'); else el.classList.remove('warning');
        }

        function triggerGameOver() {
            isGameOver = true;
            clearInterval(timerInterval);
            document.getElementById('game-over-overlay').style.display = 'flex';
            document.getElementById('numpad').style.opacity = '0.3';
            document.getElementById('numpad').style.pointerEvents = 'none';
        }

        function startTimer() {
            clearInterval(timerInterval);
            seconds = 0;
            document.getElementById('timer').innerText = "00:00";
            timerInterval = setInterval(() => {
                seconds++;
                let m = Math.floor(seconds / 60).toString().padStart(2, '0');
                let s = (seconds % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
            }, 1000);
        }

        function checkWin() {
            if (!board.includes(0) && board.every((val, i) => val === solution[i])) {
                clearInterval(timerInterval);
                setTimeout(() => alert(`æ­å–œå®Œæˆï¼ç”¨æ™‚ï¼š${document.getElementById('timer').innerText}`), 100);
            }
        }

        function promptSeed() {
            const input = prompt("è¼¸å…¥ç¨®å­ç¢¼:");
            if (input) initGame(input);
        }
        function copySeed() {
            navigator.clipboard.writeText(currentSeed);
            alert("ç¨®å­ç¢¼å·²è¤‡è£½");
        }

        // éµç›¤æ”¯æ´ (Shift=ç­†è¨˜)
        document.addEventListener('keydown', (e) => {
            if (selectedCellIndex === null) return;
            const isNote = e.shiftKey;
            if (e.key >= '1' && e.key <= '9') {
                const num = parseInt(e.key);
                if (isNote) toggleNote(num); else fillRealNumber(num);
            }
            if (e.key === 'Backspace' || e.key === 'Delete') fillRealNumber('X');
        });

        // å•Ÿå‹•
        initGame();

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js');
            });
        }
    </script>
</body>
</html>